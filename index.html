<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drama Browser</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        background: #121212;
        color: white;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    header {
        padding: 15px;
        font-size: 22px;
        font-weight: bold;
        text-align: center;
        background: #1f1f1f;
        border-bottom: 1px solid #333;
    }

    #searchBox {
        width: 90%;
        margin: 12px auto;
        padding: 10px;
        font-size: 16px;
        border-radius: 6px;
        border: none;
        outline: none;
        background: #2a2a2a;
        color: white;
    }

    .btn {
        width: 90%;
        margin: 8px auto;
        padding: 14px;
        font-size: 16px;
        background: #2c2c2c;
        color: white;
        border: 1px solid #3c3c3c;
        border-radius: 10px;
        text-align: left;
        cursor: pointer;
        transition: 0.15s;
    }
    .btn:hover {
        background: #3a3a3a;
        transform: translateY(-2px);
    }

    #backBtn {
        margin: 10px auto;
        display: none;
        background: #444;
        border: 1px solid #555;
    }

    #container {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 30px;
    }

    .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        opacity: 0.8;
    }

</style>
</head>
<body>

<header>Drama Browser</header>

<input id="searchBox" placeholder="Search titles…" oninput="filterList()">

<button id="backBtn" class="btn" onclick="goBack()">⬅ Back</button>

<div id="container" class="loading">Loading…</div>

<script>
let historyStack = [];

async function loadFeed(url) {
    document.getElementById("container").innerHTML = '<div class="loading">Loading…</div>';
    try {
        const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(url));
        const text = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "application/xml");

        const items = xml.getElementsByTagName("item");
        const container = document.getElementById("container");
        container.innerHTML = "";

        if (items.length === 0) {
            container.innerHTML = "<div class='loading'>No items found.</div>";
            return;
        }

        for (let item of items) {
            const title = item.getElementsByTagName("title")[0].textContent;
            const enclosure = item.getElementsByTagName("enclosure")[0];
            if (!enclosure) continue;

            const link = enclosure.getAttribute("url");
            const btn = document.createElement("button");
            btn.className = "btn";
            btn.textContent = title;
            btn.dataset.link = link;
            btn.onclick = () => handleLink(link);
            container.appendChild(btn);
        }

        updateBackButton();
        filterList();
    } catch (err) {
        document.getElementById("container").innerHTML = "<div class='loading'>Error loading.</div>";
    }
}

function handleLink(url) {
    if (url.startsWith("http://v.allrss.se")) {
        const clean = url.split("?")[0];
        window.open(clean, "_blank");
    } else {
        historyStack.push(url);
        loadFeed(url);
    }
}

function updateBackButton() {
    document.getElementById("backBtn").style.display = historyStack.length ? "block" : "none";
}

function goBack() {
    historyStack.pop();
    const previous = historyStack.length ? historyStack[historyStack.length - 1] : "https://allrss.se/dramas/";
    loadFeed(previous);
}

function filterList() {
    const search = document.getElementById("searchBox").value.toLowerCase();
    const buttons = document.querySelectorAll(".btn:not(#backBtn)");
    buttons.forEach(btn => {
        btn.style.display = btn.textContent.toLowerCase().includes(search) ? "block" : "none";
    });
}

loadFeed("https://allrss.se/dramas/");
</script>

</body>
</html>
